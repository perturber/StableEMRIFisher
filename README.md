# StableEMRIFisher (SEF)

[![Documentation Status](https://readthedocs.org/projects/stableemrifisher/badge/?version=latest)](https://stableemrifisher.readthedocs.io/en/latest/?badge=latest)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**StableEMRIFisher** is a Python package for computing stable Fisher information matrices for Extreme Mass Ratio Inspiral (EMRI) gravitational wave parameter estimation. It provides robust numerical derivatives and Fisher matrix analysis for EMRI waveforms generated by the [FastEMRIWaveforms](https://github.com/BlackHolePerturbationToolkit/FastEMRIWaveforms) package.

## Key Features

- üöÄ **Stable Numerical Derivatives**: Robust finite difference methods for parameter derivatives
- üñ•Ô∏è **GPU Acceleration**: Efficient computation on both CPU (NumPy) and GPU (CuPy) backends  
- üì° **LISA Integration**: Built-in LISA detector noise models and response functions
- üî¨ **EMRI Waveforms**: Seamless integration with FastEMRIWaveforms for accurate modeling
- üìä **Fisher Analysis**: Complete parameter estimation uncertainty and correlation analysis
- ‚úÖ **Validated**: Compared against MCMC parameter estimation studies

## Quick Start

### Installation

```bash
# Install from PyPI (coming soon)
pip install stableemrifisher

# Or install from source
git clone https://github.com/perturber/StableEMRIFisher.git
cd StableEMRIFisher
pip install .
```

**Required Dependencies**: You must separately install [FastEMRIWaveforms](https://github.com/BlackHolePerturbationToolkit/FastEMRIWaveforms):

```bash
pip install fastemriwaveforms
```

### Basic Usage

```python
from stableemrifisher.fisher import StableEMRIFisher

# Initialize Fisher matrix calculator
fisher_calc = StableEMRIFisher(
    waveform_model="AAKSummation",
    use_gpu=True
)

# Compute Fisher matrix for an EMRI system
fisher_matrix = fisher_calc(
    m1=1e6,      # Primary mass (solar masses)
    m2=10.0,     # Secondary mass (solar masses)
    a=0.9,       # Spin parameter
    p0=12.0,     # Initial separation
    e0=0.2,      # Initial eccentricity
    Y0=1.0,      # Initial inclination
    dist=1.0,    # Distance (Gpc)
    qS=0.5, phiS=1.0,     # Sky location
    qK=0.3, phiK=2.0,     # Spin direction  
    Phi_phi0=0.0,         # Initial phases
    Phi_theta0=0.0,
    Phi_r0=0.0,
    dt=10.0,     # Time step (seconds)
    T=1.0        # Observation time (years)
)

# Extract parameter uncertainties
import numpy as np
covariance = np.linalg.inv(fisher_matrix)
uncertainties = np.sqrt(np.diag(covariance))
print(f"Mass uncertainties: {uncertainties[0]:.2e}, {uncertainties[1]:.2e}")
```

## Documentation

üìö **Full documentation is available at [stableemrifisher.readthedocs.io](https://stableemrifisher.readthedocs.io)**

- [Installation Guide](https://stableemrifisher.readthedocs.io/en/latest/installation.html)
- [Quick Start Tutorial](https://stableemrifisher.readthedocs.io/en/latest/quickstart.html)
- [API Reference](https://stableemrifisher.readthedocs.io/en/latest/api/)
- [Examples](https://stableemrifisher.readthedocs.io/en/latest/examples.html)
- [Validation Studies](https://stableemrifisher.readthedocs.io/en/latest/validation.html)

### Building Documentation Locally

```bash
# Install documentation dependencies
pip install sphinx sphinx_rtd_theme nbsphinx

# Build documentation
cd docs
make html

# View documentation
open _build/html/index.html  # macOS
# or 
xdg-open _build/html/index.html  # Linux
```

## Examples

The `examples/` directory contains:

- **`basic_usage_stability_check.py`**: Complete Fisher matrix calculation with validation
- **`basic_usage_no_stability_check.py`**: Fast computation without stability checks
- **`SEF_inner_product_example.ipynb`**: Jupyter notebook showing inner product calculations

Run an example:

```bash
cd examples
python basic_usage_stability_check.py
```

## Physical Background

### EMRI Systems

Extreme Mass Ratio Inspirals (EMRIs) are gravitational wave sources consisting of stellar-mass compact objects (1-100 M‚òâ) spiraling into supermassive black holes (10‚Å¥-10‚Å∑ M‚òâ). They are prime targets for space-based detectors like LISA.

### Fisher Matrix Analysis

The Fisher Information Matrix provides a powerful framework for gravitational wave parameter estimation:

- **Parameter Uncertainties**: Diagonal elements give variance estimates
- **Parameter Correlations**: Off-diagonal elements reveal degeneracies
- **Detectability**: Matrix properties relate to signal-to-noise ratio
- **Mission Planning**: Optimize detector configurations and observation strategies

## Scientific Applications

StableEMRIFisher enables research in:

- üåå **Fundamental Physics**: Tests of general relativity in strong-field regimes
- üï≥Ô∏è **Black Hole Astrophysics**: Supermassive black hole demographics and formation
- üõ∞Ô∏è **LISA Science**: Mission planning and data analysis preparation
- üìà **Parameter Estimation**: Bayesian inference validation and approximation

## Dependencies

### Required
- **Python**: ‚â• 3.9
- **NumPy**: Array computation
- **SciPy**: Scientific computing
- **h5py**: Data storage
- **FastEMRIWaveforms**: EMRI waveform generation (install separately)

### Optional
- **CuPy**: GPU acceleration
- **LISAAnalysisTools**: LISA detector utilities
- **LISA-on-gpu**: GPU-accelerated LISA response
- **Matplotlib**: Plotting and visualization

## Contributing

We welcome contributions! Please:

1. üêõ **Report bugs** via [GitHub Issues](https://github.com/perturber/StableEMRIFisher/issues)
2. üí° **Suggest features** through issue discussions
3. üîß **Submit pull requests** with improvements
4. üìñ **Improve documentation** and examples

## Citation

If you use StableEMRIFisher in your research, please cite:

```bibtex
@software{kejriwal_2024_sef,
  author       = {Shubham Kejriwal and
                  Ollie Burke and
                  Christian Chapman-Bird and
                  Alvin J. K. Chua
                  },
  title        = {StableEMRIFisher (SEF)},
  publisher    = {Github},
  year         = "manuscript in preparation",
  url          = {https://github.com/perturber/StableEMRIFisher}
}
```

Please also cite [FastEMRIWaveforms](https://github.com/BlackHolePerturbationToolkit/FastEMRIWaveforms) and other dependencies as appropriate.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Support

- üìß **Questions**: Open a [GitHub Discussion](https://github.com/perturber/StableEMRIFisher/discussions)
- üêõ **Bug Reports**: Submit a [GitHub Issue](https://github.com/perturber/StableEMRIFisher/issues)
- üìö **Documentation**: Visit [stableemrifisher.readthedocs.io](https://stableemrifisher.readthedocs.io)

## Acknowledgments

Development supported by:
- European Research Council (ERC) Consolidator Grant "NewNear" (864035)
- Centre National de la Recherche Scientifique (CNRS)
- National University of Singapore

Special thanks to the FastEMRIWaveforms development team and the LISA Consortium.
